<% mails.each do |msg|
  envelope = msg.attr['ENVELOPE']
%>
<tr>
  <td class="wmail-sender">
    <% name = envelope.from[0].name.blank? ? envelope.from[0].mailbox : envelope.from[0].name %>
    <%= name.size > 25 ? name[0, 24] + '..' : name %>
  </td>
  <td class="wmail-subject">
  <%
    subject = 'No subject'

    unless envelope.subject.blank?
      subject = envelope.subject.size > 80 ? envelope.subject[0, 80] + '...' : envelope.subject
    end
  %>
    <%= link_to subject, fetch_mail_mailboxes_path(:sequence => msg.seqno) %>
  </td>
  <td class="wmail-date">
    <%= format_date(envelope.date) %>
  </td>
</tr>
<% end %>